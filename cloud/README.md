# 城市建设鹰眼系统 - 云端可视化平台

一个基于Web的建筑缺陷检测和3D点云可视化系统。

## 功能特性

- 🌐 **Web界面**: 现代化的响应式Web界面
- 📊 **3D点云可视化**: 基于Three.js的交互式3D点云展示
- 🗺️ **地图集成**: 高德地图API集成，显示建筑物位置
- 🔍 **缺陷分析**: 自动分析建筑缺陷，按严重程度排序
- 👁️ **人工复检**: 直观的缺陷复检界面
- 🤖 **AI分析**: 集成Gemini AI进行智能建筑分析
- 📈 **统计报告**: 详细的数据统计和报告生成
- 🚀 **SSH连接**: 自动连接下位机获取数据

## 系统架构

### 后端技术栈
- **FastAPI**: Web框架
- **Open3D**: 点云处理
- **OpenCV**: 图像处理
- **Paramiko**: SSH连接
- **Google Gemini API**: AI分析

### 前端技术栈
- **Three.js**: 3D渲染
- **高德地图API**: 地图服务
- **现代CSS**: 科技感UI设计
- **原生JavaScript**: 前端交互

## 安装和运行

### 方法一：使用启动脚本 (推荐)

1. 双击运行 `start.bat`
2. 脚本会自动：
   - 创建虚拟环境
   - 安装依赖
   - 启动服务

### 方法二：手动安装

1. 创建虚拟环境：
```bash
python -m venv venv
venv\Scripts\activate
```

2. 安装依赖：
```bash
pip install -r requirements.txt
```

3. 设置环境变量：
```bash
set GEMINI_API_KEY=your_api_key_here
```

4. 启动服务：
```bash
python main.py
```

5. 打开浏览器访问：`http://localhost:8000`

## 配置要求

### 系统要求
- Windows 10/11
- Python 3.8+
- 8GB+ RAM
- 支持WebGL的浏览器

### API密钥
- Gemini API密钥 (用于AI分析)
- 高德地图API密钥 (用于地图显示)

## 使用说明

### 1. 连接下位机
- 在总览页面输入下位机IP地址
- 输入SSH用户名和密码
- 指定数据存储路径
- 点击"连接并下载数据"

### 2. 点云可视化
- 切换到"点云可视化"页面
- 选择会话ID
- 点击"加载点云"
- 使用鼠标交互操作3D视图

### 3. 缺陷复检
- 切换到"缺陷复检"页面
- 选择会话ID
- 点击"加载缺陷"
- 逐一复检缺陷，点击"通过"或"不通过"

### 4. AI分析
- 切换到"AI分析"页面
- 选择会话ID
- 点击"开始分析"
- 查看AI生成的分析报告

### 5. 统计报告
- 切换到"统计报告"页面
- 选择会话ID
- 点击"生成报告"
- 查看详细统计数据

## 数据格式

### 下位机数据结构
```
session_id/
├── images/           # 原始图像
├── masks/           # 分割掩码
├── pointclouds.pcd  # 点云文件
└── location.txt     # GPS坐标
```

### GPS坐标格式
```
start_lat,start_lon
end_lat,end_lon
```

## 缺陷分析

系统支持三种类型的缺陷：
- 🔴 **红色缺陷**: 严重缺陷 (权重: 3.0)
- 🔵 **蓝色缺陷**: 中等缺陷 (权重: 2.0)
- 🟢 **绿色缺陷**: 轻微缺陷 (权重: 1.5)

严重程度 = 缺陷面积百分比 × 对应权重

## 目录结构

```
cloud/
├── main.py              # 主程序
├── requirements.txt     # 依赖列表
├── start.bat           # 启动脚本
├── services/           # 服务层
│   ├── ssh_client.py   # SSH连接
│   ├── pcd_processor.py # 点云处理
│   ├── gemini_client.py # AI分析
│   └── data_manager.py  # 数据管理
├── utils/              # 工具函数
│   └── image_utils.py  # 图像处理
├── templates/          # HTML模板
│   └── index.html
├── static/            # 静态资源
│   ├── css/
│   └── js/
└── data/              # 数据存储
    ├── sessions/      # 会话数据
    └── results/       # 分析结果
```

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 确认SSH凭据正确
   - 验证下位机IP地址

2. **点云加载失败**
   - 检查PCD文件是否存在
   - 确认文件格式正确
   - 尝试降低点云分辨率

3. **AI分析失败**
   - 检查Gemini API密钥
   - 确认网络连接
   - 查看API使用配额

4. **地图显示问题**
   - 检查高德地图API密钥
   - 确认GPS坐标格式
   - 检查浏览器网络权限

### 性能优化

1. **点云优化**
   - 自动降采样大型点云
   - 使用LOD技术
   - 启用GPU加速

2. **内存管理**
   - 定期清理旧会话
   - 限制同时加载的数据量
   - 优化图像缓存

## 开发说明

### 项目特点
- **Demo导向**: 重点关注功能完整性和UI美观度
- **简化设计**: 不考虑复杂的错误处理和跨平台兼容性
- **科技感UI**: 现代化的渐变和毛玻璃效果
- **模块化架构**: 清晰的前后端分离

### 扩展功能
- 支持更多点云格式
- 增加实时数据流
- 集成更多AI模型
- 添加用户权限管理

## 许可证

本项目仅用于展示和演示目的。

## 联系方式

如有问题或建议，请联系开发团队。
