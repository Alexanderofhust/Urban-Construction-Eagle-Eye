# 先验
1. 父程序是一个雷达+视觉的融合系统，同时进行建图和建筑物缺陷检测，建筑物缺陷使用特定鲜艳颜色标识。
2. 父程序基于ros2，会在使用时进行pcd点云数据的合成和相机原图+检测结果图的保存，运行在Ubuntu系统上。
3. 本程序为web+python前后端，运行在Windows系统上。
4. 建筑物缺陷检测结果是一个mask，分别有黑色背景色，红色缺陷1，蓝色缺陷2，绿色缺陷3等。

# 云端代码需求
1. 需要一个web端的可视化界面，能够展示最终建图后的3d点云结果，可使用鼠标放缩拖动旋转等。
2. 需要将上述结果与地图位置相关联，便于用户查看。
3. 需要生成量化分析数据。
4. 需要在网页提供一个连接按钮，点击后连接指定ip的Ubuntu系统，获取存放在指定文件夹下的pcd文件和图片压缩包数据。然后统一进行可视化。（提供加载进度条）
5. 需要提供人工复检功能，即将检测mask图中的较为严重的部分筛选出来放在web界面中，用户可以进行复检和确认。（复检后无须返回给父程序，而是仅简单保存结果）
6. 需要通过gemini api（额度有限），分析3d数据，给出建筑物描述，整体评估，修复建议等。（可以设计精美UI界面，根据损失程度分级）
7. 本程序需要参加比赛，要求UI精美，设计科学，呈现富有科技感而简洁。

# Q&A
GitHub Copilot
基于我对项目的理解，我有以下几个重要的技术细节和设计决策需要确认：

1. 技术架构相关
后端框架选择：我看到 main.py 中已经使用了 FastAPI，这是个不错的选择。我们是否继续使用 FastAPI 作为后端框架？

前端技术栈：对于需要展示3D点云和地图的Web界面，我建议使用：

React/Vue.js + Three.js (用于3D点云可视化)
或者直接使用 WebGL/Babylon.js
地图展示可以使用高德地图API或高德地图API 您倾向于哪种技术栈？
Answer：可以自由选择，要求代码尽量简单即可，使用高德地图API。

远程连接方式：

Ubuntu系统的连接是通过SSH、ROS2网络通信，还是其他协议？
数据文件是需要实时传输还是可以先下载到本地再处理？
文件大小预期有多大？需要考虑传输优化吗？
Answer：通过SSH连接，我们会先手动在下位机上启动工作，等到所有工作完成后，再打开上位机的前后端进行可视化，所以其实没有云端，而是在上位机本地运行网页，点击按钮后立刻通过ssh等方式获取点云结果和检测结果数据，等待全部下载完成后进行可视化。
3. 3D点云可视化
点云处理库：

是否继续使用Open3D，还是考虑其他库如PCL？
点云数据量级大概是多少？需要考虑降采样或LOD优化吗？
是否需要支持点云的实时流式传输？
Answer：不需要实时性，最好呈现出点云全部建完后的场景，其他方面你是专业的，可以先生成初版，性能不够再改进。
4. 地图集成
地图服务：

您希望使用哪个地图服务？(百度地图、高德地图、OpenStreetMap等)
需要支持哪些地图功能？(标记、路径规划、卫星图层等)
GPS坐标系统使用哪种？(WGS84、GCJ02等)
Answer：使用高德地图API，支持标记和卫星图层即可，GPS坐标系统是什么？事实上，我的数据并没有经纬度数据，所以其实是这样的，我们在下位机采集数据前会通过定位获取自身经纬度信息，然后在文件夹下附上txt文件，里面存放经纬度信息（其实是两个点的经纬度来表示一个框）。
5. AI分析功能
Gemini API集成：

您有Gemini API的具体配置要求吗？
分析的数据格式是什么？(文本描述、图像、3D数据的2D投影等)
是否需要批量分析还是单个建筑分析？
Answer：使用免费的flash api，最好能输入图像数据以得到更准确的反馈，不需要批量，因为这个项目是一个demo性质的项目，所以重点是功能亮眼，设计完整漂亮，完成度高。
6. 用户界面设计
UI风格：

您有特定的设计风格偏好吗？(Material Design、Ant Design等)
需要支持哪些设备？(桌面、平板、手机)
是否有特定的颜色主题要求？
Answer：仅支持桌面端（Windows系统）。无其他这方面要求，UI设计现代化。
复检功能：

复检界面需要什么样的交互方式？(标注工具、评分系统等)
结果保存格式是什么？(JSON、数据库等)
Answer：复检仅需要给出两个按钮，分别是“通过”和“不通过”，不需要其他复杂功能。结果保存为JSON格式即可。
7. 部署和性能
部署环境：

预期的用户并发量是多少？
是否需要考虑Docker容器化部署？
数据存储使用什么方案？(SQLite、PostgreSQL、文件系统等)
Answer：无并发要求，部署在Windows系统上即可。数据存储使用文件系统即可。

Conclusions
这个项目的定位是一个建筑缺陷建图与分析的系统工具，目前已完成下位机（Ubuntu系统）的采集和处理部分，所以以上是对本地可视化网页界面的需求和设计思路。所以并不是云端、服务器之类的，而是重点放在本地可视化和分析设计上，要求呈现出现代化的解决方案和完成度高的可视化界面。

# 下位机数据目录

xxx/
├── session_id/
│   ├── images/           # 原始图像
│   ├── masks/           # 分割mask
│   ├── pointclouds.pcd     # 点云PCD
│   └── location.txt        # gps数据

# Q&A2
ip地址在网页中输入，密码认证，数据存放固定一个文件夹，下载不需要检查完整性，严重程度按照缺陷面积来判断，展示最严重的10张，复检有专门的一个子界面，左侧显示原图，右侧显示叠加图，我希望给Gemini输入点云的3d渲染图（注意节省api使用），已有api key， gps文件格式你规定即可，视角控制你自己设定，渲染不需要太复杂，类似rviz，交互功能只需要旋转缩放，统计指标你自定，页面切换必须有，我认为要有点云界面，复检界面等，你可以自由设计。